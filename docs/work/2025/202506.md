# 202506

::: info

> åœ¨å¼ æ±Ÿåº¦è¿‡äº†å››å¹´éš¾å¿˜çš„ç”Ÿæ´»ï¼Œç°åœ¨å› å…¬å¸æ¬è¿åˆ°é™å®‰ï¼Œæˆ‘éšä¹‹æ¬åˆ°é™å®‰ï¼Œæœ‰ç‚¹ä¸é€‚åº”è¿™è¾¹çš„è€ç ´å°

:::

## 0601

- æ¬åˆ°é™å®‰é˜³æ›²è·¯çš„ç¬¬ä¸€å¤©ï¼Œè¿‡çš„éå¸¸ä¸å¥½ï¼Œå®ç°ä¸ä¹ æƒ¯è¿™è¾¹çš„è€ç ´å°

## 0610

- 1462
- è¢«æ”¶è´­å°˜åŸƒè½å®šï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç­‰å¾…æ…¢æ…¢è¢«è¾¹ç¼˜åŒ–ï¼Œç„¶åè¢«å¹²æ‰

## 0612

- 1464
- å¦‚æœçŸ¥é“è‡ªå·±ä¸¤ä¸ªæœˆä¹‹åè¢«å¹²æ‰ï¼Œå¦‚ä½•åšå¥½å‰ç«¯é¢è¯•ï¼Ÿåˆè¦å‡†å¤‡å‰ç«¯é¢è¯•ï¼ŸçœŸçš„æ˜¯å·²ç»éº»æœ¨äº†ï¼Œä¼šä¸ä¼šå†™éƒ½ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æ€è·¯å’Œçœ¼ç•Œï¼Ÿ
- æ‰‹å†™å‰ç«¯

```js
//äºŒåˆ†æŸ¥æ‰¾

function bindSearch(arr, target) {
  let l = 0
  let r = arr.length - 1
  while (l <= r) {
    let mid = (l + r) >> 1
    if (arr[mid] == target) {
      return mid
    } else if (arr[mid] > target) {
      r = mid - 1
    } else {
      l = mid + 1
    }
  }
}
// 10. æ‰¾å‡ºç¬¬ä¸€ä¸ªä¸è‰¯ç‰ˆæœ¬
// This is a JavaScript coding problem from BFE.dev

/**
 * @typedef {(version: number) => boolean} IsBad
 */

/**
 * @param {IsBad} isBad
 * @return {(v: number) => number}
 */
function firstBadVersion(isBad) {
  // firstBadVersion receive a check function isBad
  // and should return a closure which accepts a version number(integer)
  return (version) => {
    // write your code to return the first bad version
    // if none found, return -1
  }
}
```

- å‰ç«¯è€å…µå¦‚ä½•å‡†å¤‡é¢è¯•ï¼Ÿ

::: info

âš™ï¸ ä¸€ã€æŠ€æœ¯æ·±åº¦å¼ºåŒ–ï¼šæŸ¥æ¼è¡¥ç¼ºä¸å‰æ²¿èåˆ

1.  åŸºç¡€å¤ç›˜ä¸æ¡†æ¶åŸç†

æ ¸å¿ƒåŸºç¡€ï¼šé‡ç‚¹å¤ä¹  JavaScript é—­åŒ…/åŸå‹é“¾/äº‹ä»¶å¾ªç¯ã€CSS å¸ƒå±€ï¼ˆFlex/Gridï¼‰ å’Œ æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶ï¼ˆé‡ç»˜/å›æµï¼‰ã€‚
æ¡†æ¶åº•å±‚ï¼šæ·±å…¥ç†è§£ React/Vue çš„è™šæ‹Ÿ DOMã€Diff ç®—æ³•ã€çŠ¶æ€ç®¡ç†ï¼ˆRedux/Vuexï¼‰ï¼Œå¹¶èƒ½æ‰‹å†™ç®€æ˜“å®ç°ã€‚
å·¥ç¨‹åŒ–ï¼šæŒæ¡ Webpack ä¼˜åŒ–ï¼ˆTree Shakingã€Code Splittingï¼‰ å’Œ CI/CD æµç¨‹ï¼ˆå¦‚ Jenkins éƒ¨ç½²ï¼‰ã€‚ 2.
æ€§èƒ½ä¼˜åŒ–å®æˆ˜

å‡†å¤‡ å¯é‡åŒ–çš„ä¼˜åŒ–æ¡ˆä¾‹ï¼šä¾‹å¦‚é€šè¿‡ æ‡’åŠ è½½ã€èµ„æºå‹ç¼©ã€SSR å°†é¦–å±åŠ è½½æ—¶é—´ä» 5s é™è‡³ 1.5sï¼Œä½¿ç”¨ Chrome DevTools æˆ– Lighthouse åˆ†æè¿‡ç¨‹ã€‚
æŒæ¡ æ€§èƒ½ä¼˜åŒ–é—­ç¯ï¼šåˆ†æ â†’ å®šä½ç“¶é¢ˆï¼ˆå¦‚ JS æ‰§è¡Œè€—æ—¶ï¼‰â†’ å®æ–½ä¼˜åŒ– â†’ éªŒè¯æ•ˆæœï¼ˆLighthouse è¯„åˆ†æå‡ï¼‰ã€‚ 3.
å‰æ²¿æŠ€æœ¯ç»“åˆ

æ™ºèƒ½åŒ–å·¥å…·ï¼šå¦‚ InsCode AI IDE è¾…åŠ©ä»£ç ç”Ÿæˆä¸è°ƒè¯•ï¼Œå±•ç¤ºæŠ€æœ¯æ•æ„Ÿåº¦ã€‚
è·¨ç«¯/æ–°å…´æŠ€æœ¯ï¼šäº†è§£ PWA ç¦»çº¿æ–¹æ¡ˆã€WebAssembly åº”ç”¨ï¼Œæˆ– å¾®å‰ç«¯æ¶æ„ çš„è½åœ°ç»éªŒã€‚

ğŸ“‚ äºŒã€é¡¹ç›®ç»éªŒåŒ…è£…ï¼šçªå‡ºæŠ€æœ¯å†³ç­–ä¸ä¸šåŠ¡ä»·å€¼
é‡‡ç”¨ STAR æ³•åˆ™ ç»“æ„åŒ–è¡¨è¾¾é¡¹ç›®ï¼Œå¹¶èšç„¦ä»¥ä¸‹ç»´åº¦ï¼š

éš¾ç‚¹çªç ´ï¼š
ä¾‹å¦‚è§£å†³ 10W+ æ•°æ®åˆ—è¡¨æ¸²æŸ“å¡é¡¿ï¼Œé‡‡ç”¨ è™šæ‹Ÿæ»šåŠ¨ï¼ˆreact-windowï¼‰ + Web Worker æ‹†åˆ†è®¡ç®—ã€‚
å¤„ç† è€æ—§æµè§ˆå™¨å…¼å®¹ï¼Œé€šè¿‡ PostCSS è‡ªåŠ¨å‰ç¼€ + Polyfill æ–¹æ¡ˆã€‚
ä¸šåŠ¡å½±å“ï¼š
é‡åŒ–ç»“æœï¼šå¦‚â€œä¼˜åŒ–åç”¨æˆ·è½¬åŒ–ç‡æå‡ 20%â€æˆ–â€œé”™è¯¯ç‡ä¸‹é™ 40%ï¼ˆæ¥å…¥ Sentryï¼‰â€ã€‚
å·¥ç¨‹åŒ–è´¡çŒ®ï¼š
åŸºå»ºå»ºè®¾ï¼šæ¨åŠ¨ ç»„ä»¶åº“å¼€å‘ï¼ˆèŠ‚çœ 40% é‡å¤ä»£ç ï¼‰ æˆ– è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–ã€‚
ğŸ’¡ æç¤ºï¼šé€‰æ‹© 3 ä¸ªæ ¸å¿ƒé¡¹ç›® æ·±åº¦å‡†å¤‡ï¼Œç¡®ä¿æŠ€æœ¯ç»†èŠ‚æ¸…æ™°ï¼Œé¿å…æ³›æ³›è€Œè°ˆã€‚

ğŸ¯ ä¸‰ã€é¢è¯•å…¨æµç¨‹ç­–ç•¥
é˜¶æ®µ å…³é”®åŠ¨ä½œ
é¢è¯•å‰ - åˆ·é¢˜ï¼šLeetCode ä¸­ç­‰éš¾åº¦ç®—æ³•ï¼ˆä¾§é‡æ•°ç»„/å­—ç¬¦ä¸²å¤„ç†ï¼‰ï¼Œç‰›å®¢ç½‘å‰ç«¯ä¸“é¡¹é¢˜ã€‚

- æ¨¡æ‹Ÿé¢è¯•ï¼šæ‰¾åŒè¡Œæ¨¡æ‹ŸæŠ€æœ¯è¿½é—®ï¼ˆå¦‚â€œReact Fiber å¦‚ä½•ä¸­æ–­ä»»åŠ¡ï¼Ÿâ€ï¼‰ã€‚
  é¢è¯•ä¸­ - æŠ€æœ¯å›ç­”ï¼šå…ˆæ¦‚æ‹¬æ€è·¯ â†’ åˆ†æ­¥å®ç° â†’ å¤æ‚åº¦åˆ†æã€‚
- å¼€æ”¾é¢˜ï¼šç»“åˆé¡¹ç›®ç»éªŒç­”ï¼ˆä¾‹ï¼šâ€œä»è¾“å…¥ URL åˆ°é¡µé¢æ˜¾ç¤ºâ€å¯å…³è”æ€§èƒ½ä¼˜åŒ–å®è·µï¼‰ã€‚
  HR é¢ - è–ªèµ„è°ˆåˆ¤ï¼šä¾æ®å²—ä½é¢„ç®—ï¼ˆå‚è€ƒ Boss ç›´è˜/è„‰è„‰è–ªèµ„èŒƒå›´ï¼‰ï¼Œå¼ºè°ƒæŠ€æœ¯è½åœ°èƒ½åŠ›ã€‚
- æ–‡åŒ–åŒ¹é…ï¼šæå‰è°ƒç ”å…¬å¸æŠ€æœ¯æ ˆï¼ˆå¦‚æ˜¯å¦é‡ Vue3ï¼‰ï¼Œè¡¨è¾¾æŠ€æœ¯è®¤åŒã€‚

ğŸš€ å››ã€å·®å¼‚åŒ–ç«äº‰åŠ›ï¼šå‡¸æ˜¾èµ„æ·±è§’è‰²ä»·å€¼ 1.æ¶æ„æ€ç»´ï¼š
è¯´æ˜æŠ€æœ¯é€‰å‹æƒè¡¡ï¼ˆå¦‚ Vue3 vs React çš„å–èˆä¾æ®ï¼‰ã€‚ 2.è·¨èŒèƒ½åä½œï¼š
ä¸¾ä¾‹å¦‚ä½•æ¨åŠ¨ åç«¯å®šåˆ¶ API æ ¼å¼ æˆ– ä¸äº§å“æ²Ÿé€šéœ€æ±‚åˆç†æ€§ã€‚ 3.æ–°äººèµ‹èƒ½ï¼š
åˆ†äº« Code Review ç»éªŒ æˆ– å†…éƒ¨æŠ€æœ¯åˆ†äº« æ¡ˆä¾‹ï¼Œä½“ç°é¢†å¯¼åŠ›ã€‚

ğŸ’ª äº”ã€å¿ƒæ€ä¸èµ„æºå‡†å¤‡
å»ºç«‹ä¸ªäººå“ç‰Œï¼šæ›´æ–° GitHubï¼ˆçªå‡ºé«˜è´¨é‡é¡¹ç›®ï¼‰ã€æŠ€æœ¯åšå®¢ï¼ˆå¤ç›˜éš¾ç‚¹è§£å†³æ–¹æ¡ˆï¼‰ã€‚
è¡Œä¸šåŠ¨æ€ï¼šå…³æ³¨ å‰ç«¯æ¡†æ¶æ›´æ–°ï¼ˆå¦‚ React 19ï¼‰ã€Web ç”Ÿæ€å˜åŒ–ï¼ˆå¦‚ HTTP3 åº”ç”¨ï¼‰ã€‚
å¿ƒç†å»ºè®¾ï¼šå°†è£å‘˜è§†ä¸ºèŒä¸šè·ƒè¿æœºä¼šï¼Œèšç„¦é•¿æœŸæˆé•¿ã€‚

ğŸ“Œ èµ„æºæ¨èï¼š

çŸ¥è¯†ä½“ç³»æ„å»ºï¼šå‰ç«¯é¢è¯•ä½“ç³»æ ¸å¿ƒæˆ˜ç•¥
é«˜é¢‘é¢˜åº“ï¼šå‰ç«¯é¢è¯•é¢˜å…¨é›†
æœ€åæé†’ï¼šèµ„æ·±å¼€å‘è€…çš„æ ¸å¿ƒä»·å€¼åœ¨äº **æŠ€æœ¯æ·±åº¦ + ä¸šåŠ¡ç†è§£ + å·¥ç¨‹æ•ˆç‡** çš„ç»“åˆã€‚é¢è¯•æ—¶ä¿æŒè‡ªä¿¡ï¼Œç”¨æ•°æ®å’Œé€»è¾‘è¯´è¯ï¼Œä½ çš„ç»éªŒæ­£æ˜¯å›¢é˜Ÿæœ€éœ€è¦çš„ç¨³å®šåŠ›é‡ã€‚

:::

## 0613

- 1465
- å¾®å‰ç«¯æ¡†æ¶(ä¹¾å¤)å®è·µä¸‹
- å¦‚ä½•ä¸‹è½½ä¸€ä¸ªå›ºå®šåœ°å€ï¼Ÿ

> URL.createObjectURL() é™æ€æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª DOMStringï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªè¡¨ç¤ºå‚æ•°ä¸­ç»™å‡ºçš„å¯¹è±¡çš„ URLã€‚è¿™ä¸ª URL çš„ç”Ÿå‘½å‘¨æœŸå’Œåˆ›å»ºå®ƒçš„çª—å£ä¸­çš„ document ç»‘å®šã€‚

```js
function download(blob) {
  const url = window.URL.createObjectURL(blob) // url
  const a = document.createElement("a")
  a.href = url
  a.download = "test.doc" // æ–‡ä»¶å
  document.body.appendChild(a)
  a.click()
}
```

## 0615

- 1467
- æ‰‹å†™ ä»€ä¹ˆæ˜¯ Composition?å®ç° pipe()

```js
function pipe(fns) {
  if (fns.length === 0) return (...arg) => arg
  if (fns.length === 1) return fns[0]
  // return fns.reduce((pre, cur) => {
  //   return cur(pre)
  // }, Promise.resolve())
  return function (arg) => {
    return fns.reduce((pre, cur) => cur(pre), arg)
  }
}
```

- æ‰‹å†™å®ç°`memo()`

```js
const memoed = memo(func, () => "samekey")
memoed(1, 2)
// 3ï¼Œfuncè¢«è°ƒç”¨ï¼Œç¼“å­˜keyæ˜¯ 'samekey'
memoed(1, 2)
// 3ï¼Œå› ä¸ºkeyæ˜¯ä¸€æ ·çš„ï¼Œ3è¢«ç›´æ¥è¿”å›ï¼Œfuncæœªè°ƒç”¨
memoed(1, 3)
// function memo(fn, key = Array.from(arguments).join("_")) {
//   let cache = new Map()
//   return (...arg) => {
//     let val = fn.apply(this, arg)
//     if (cache.has(key)) {
//       return cache.get(key)
//     }
//     cache.set(key, val)
//   }
// }
function memo(fnc, resolver = (...arg) => arg.join("_")) {
  let cache = new Map()
  return function (...arg) {
    let key = resolver(arg)
    if (cache.has(key)) {
      return cache.get(key)
    }
    let val = fnc.apply(this, arg)
    cache.set(key, val)
    return val
  }
}
```

### [æ‰‹å†™ï¼šå®ç°ä¸€ä¸ª DOM element store](https://bigfrontend.dev/zh/problem/create-a-simple-store-for-DOM-node)

```js
// wrong
class NodeStore {
  let obj = {}
  set(node, value) {
    obj[JSON.stringfy(node)] = value
  }

  get(node) {
    return obj[JSON.stringfy(node)]
  }

  has(node) {
    if (obj[JSON.stringfy(node)]) {
      return true
    } else {
      retun false
    }
  }
}
// ok
class NodeStore {
  static nodes = {}
  /**
   * @param {Node} node
   * @param {any} value
   */
  set(node, value) {
   node.__node_key_ = Symbol()
   this.nodes[node.__node_key_] = value
  }
  /**
   * @param {Node} node
   * @return {any}
   */
  get(node) {
    return this.nodes[node.__node_key_]
  }

  /**
   * @param {Node} node
   * @return {Boolean}
   */
  has(node) {
    return !!this.nodes[node.__node_key_]
  }
}
```

## 0616

- 1469
- redux ä¸­çš„ Thunk æ˜¯å•¥

:::info

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œâ€‹â€‹Thunkâ€‹â€‹ æ˜¯ä¸€ç§ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„ç¼–ç¨‹æ¨¡å¼ï¼Œå°¤å…¶åœ¨ Redux ç­‰çŠ¶æ€ç®¡ç†åº“ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¼‚æ­¥é€»è¾‘å°è£…æˆä¸€ä¸ªå‡½æ•°ï¼ˆé«˜é˜¶å‡½æ•°ï¼‰ï¼Œå»¶è¿Ÿæ‰§è¡Œå¹¶åŠ¨æ€åˆ†å‘ï¼ˆdispatchï¼‰åŒæ­¥çš„ Actionï¼Œä»è€Œè§£å†³ **Redux åŸç”Ÿä»…æ”¯æŒåŒæ­¥ Action çš„é™åˆ¶**ã€‚

- â€‹â€‹ å®šä¹‰ â€‹â€‹
  Thunk æ˜¯ä¸€ä¸ªè¿”å›å‡½æ•°çš„å‡½æ•°ï¼ˆé«˜é˜¶å‡½æ•°ï¼‰ï¼Œè¿™ä¸ªè¿”å›çš„å‡½æ•°æ¥æ”¶ dispatch å’Œ getState ä½œä¸ºå‚æ•°ï¼Œå…è®¸åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ‰‹åŠ¨è§¦å‘ Action

```js
// æ™®é€š Action Creatorï¼ˆåŒæ­¥ï¼‰
const syncAction = () => ({ type: "SYNC_ACTION" })

// Thunk Action Creatorï¼ˆå¼‚æ­¥ï¼‰
const thunkAction = () => {
  return (dispatch, getState) => {
    // å¼‚æ­¥æ“ä½œï¼ˆå¦‚ API è¯·æ±‚ï¼‰
    fetch("/api/data").then((data) => {
      dispatch({ type: "DATA_LOADED", payload: data })
    })
  }
}
```

â€‹â€‹- ä½œç”¨ â€‹â€‹
â€‹â€‹ è§£è€¦å¼‚æ­¥é€»è¾‘ â€‹â€‹ï¼šå°†å¼‚æ­¥ä»£ç ä» React ç»„ä»¶ä¸­æŠ½ç¦»ï¼Œä¿æŒç»„ä»¶çº¯å‡€ã€‚
â€‹â€‹ åŠ¨æ€æ§åˆ¶æµç¨‹ â€‹â€‹ï¼šæ”¯æŒæ¡ä»¶åˆ†å‘ Actionï¼ˆä¾‹å¦‚æ ¹æ®å¼‚æ­¥ç»“æœå†³å®šåç»­æ“ä½œï¼‰ã€‚
â€‹â€‹ é”™è¯¯å¤„ç† â€‹â€‹ï¼šé›†ä¸­å¤„ç†å¼‚æ­¥é”™è¯¯ï¼Œé¿å…åœ¨ç»„ä»¶ä¸­é‡å¤ç¼–å†™ try/catch

äºŒã€Thunk çš„å…¸å‹åº”ç”¨åœºæ™¯
åœºæ™¯ 1ï¼šå¼‚æ­¥æ•°æ®è·å–ï¼ˆå¦‚ API è¯·æ±‚ï¼‰

```js
// Action Creator
const fetchUser = (userId) => {
  return async (dispatch, getState) => {
    dispatch({ type: 'FETCH_USER_REQUEST' });
    try {
      const response = await fetch(`/api/users/${userId}`);
      const user = await response.json();
      dispatch({ type: 'FETCH_USER_SUCCESS', payload: user });
    } catch (error) {
      dispatch({ type: 'FETCH_USER_FAILURE', error });
    }
  };
};

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
componentDidMount() {
  this.props.dispatch(fetchUser(123));
}
```

ä¸‰ã€Thunk çš„å®ç°åŸç†
1.â€‹â€‹ ä¸­é—´ä»¶æœºåˆ¶ â€‹â€‹
Redux Thunk é€šè¿‡ä¸­é—´ä»¶æ‹¦æˆª Actionï¼Œåˆ¤æ–­å…¶ç±»å‹ï¼š
è‹¥ Action æ˜¯æ™®é€šå¯¹è±¡ï¼ˆplain objectï¼‰ï¼ŒæŒ‰æ­£å¸¸æµç¨‹å¤„ç†ã€‚
è‹¥ Action æ˜¯å‡½æ•°ï¼ˆThunkï¼‰ï¼Œåˆ™æ‰§è¡Œè¯¥å‡½æ•°å¹¶ä¼ å…¥ dispatch å’Œ getState

```js
const thunkMiddleware =
  ({ dispatch, getState }) =>
  (next) =>
  (action) => {
    if (typeof action === "function") {
      return action(dispatch, getState) // æ‰§è¡Œ Thunk å‡½æ•°
    }
    return next(action) // æ™®é€š Action ç»§ç»­ä¼ é€’
  }
```

2.â€‹â€‹ ä¸ Generator çš„å¯¹æ¯” â€‹â€‹
â€‹- â€‹Thunkâ€‹â€‹ï¼šåŸºäºé—­åŒ…å’Œå›è°ƒï¼Œä»£ç ç®€å•ä½†éœ€æ‰‹åŠ¨å¤„ç†å¼‚æ­¥æµç¨‹ã€‚
â€‹â€‹- Redux-Sagaâ€‹â€‹ï¼šåŸºäº Generator å‡½æ•°ï¼Œé€šè¿‡ yield æš‚åœ/æ¢å¤å¼‚æ­¥ä»»åŠ¡ï¼Œé€‚åˆå¤æ‚å¼‚æ­¥æµæ§åˆ¶

å››ï¼šæ€»ç»“
Thunk æ˜¯ Redux ç”Ÿæ€ä¸­å¤„ç†å¼‚æ­¥æ“ä½œçš„åŸºç¡€å·¥å…·ï¼Œé€šè¿‡å°†å¼‚æ­¥é€»è¾‘å°è£…ä¸ºå‡½æ•°ï¼Œå®ç°äº†çŠ¶æ€ç®¡ç†çš„è§£è€¦å’Œä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚å¯¹äºç®€å•åœºæ™¯ï¼ˆå¦‚ API è¯·æ±‚ï¼‰ï¼ŒThunk è¶³å¤Ÿé«˜æ•ˆï¼›å¤æ‚åœºæ™¯å¯ç»“åˆ Saga æˆ– RxJS ç­‰æ–¹æ¡ˆã€‚ç†è§£ Thunk çš„åŸç†å’Œé€‚ç”¨è¾¹ç•Œï¼Œèƒ½å¸®åŠ©å¼€å‘è€…æ›´åˆç†åœ°è®¾è®¡å‰ç«¯æ¶æ„ã€‚

:::

- æ‰‹å†™æ‰å¹³åŒ–çš„ Thunk

```js
type Callback = (error: Error, result: any | Thunk) => void

// Thunkæ˜¯æ¥å—Callbackä¸ºå‚æ•°çš„å‡½æ•°ã€‚
type Thunk = (callback: Callback) => void

const func1 = (cb) => {
  setTimeout(() => cb(null, "ok"), 10)
}
const func2 = (cb) => {
  setTimeout(() => cb(null, func1), 10)
}
const func3 = (cb) => {
  setTimeout(() => cb(null, func2), 10)
}

flattenThunk(func3)((error, data) => {
  console.log(data) // 'ok'
})

// /**
//  * @param {Thunk} thunk
//  * @return {Thunk}
//  */
// function flattenThunk(thunk) {
//   return (error, data) => {
//     if (error) {
//       throw error
//     }
//     let val = thunk(data)
//   }
// }
//å½“Errorå‘ç”Ÿæ—¶ï¼Œå°šæœªè¢«è°ƒç”¨çš„å‡½æ•°éœ€è¦è¢«è·³è¿‡
/**
 * @param {Thunk} thunk
 * @return {Thunk}
 * /ç®€å•æ¥è¯´å°±æ˜¯åŠ«æŒcallback,è‡ªå·±å®ç°ä¸€ä¸ªæ”¯æŒé“¾å¼è°ƒç”¨çš„callback;
 */
function flattenThunk(thunk) {
  return function (cb) {
    const _cb = (error, data) => {
      if (error) {
        cb(error)
      } else if (typeof data === "function") {
        data(_cb)
      } else {
        cb(error, data)
      }
    }
    thunk(_cb)
  }
}
function flattenThunk(thunk) {
  return function (cb) {
    function wrapper(err, data) {
      return typeof data == "function" ? data(wrapper) : cb(err, data)
    }
    thunk(wrapper)
  }
}
```

- æ‰‹å†™ compose ç»„åˆï¼Œkoa æ´‹è‘±æ¨¡å‹

```js
function compose(fns) {
  return (context, next) => {
    return dispatch(0)
    function dispatch(i) {
      let fn = fns[i]
      if (!fn) return Promise.resolve()
      if (i === fns.length) fn = next
      try {
        return Promise.resolve(fn.call(context, () => dispatch(i + 1)))
      } catch (e) {
        return Promise.reject(e)
      }
    }
  }
}
```

- æ‰‹å†™ Promise.race()

è¯¥é—®é¢˜æœ‰äº›ç±»ä¼¼ 31. å®ç° async helper - race()ï¼Œåªä¸è¿‡å¤„ç†çš„æ˜¯ Promiseã€‚

Promise.race(iterable) æ–¹æ³•è¿”å›ä¸€ä¸ª promiseï¼Œä¸€æ—¦è¿­ä»£å™¨ä¸­çš„æŸä¸ª promise è§£å†³æˆ–æ‹’ç»ï¼Œè¿”å›çš„ promise å°±ä¼šè§£å†³æˆ–æ‹’ç»ã€‚source: MDN

ä½ èƒ½å®ç°è‡ªå·±çš„ Promise.race()å—ï¼Ÿ

```js
Promise.prototype.myRace = function (arr) {
  return new Promise((resolve, reject) => {
    arr.forEach((item) => {
      return Promise.resolve(item).then(resolve).catch(reject)
    })
  })
}
```

- æ ¸å¿ƒåŸç†ï¼šåŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰é™åˆ¶çš„æ˜¯ä¸åŒæºè„šæœ¬è¯»å–å¯¹æ–¹æ•°æ®çš„èƒ½åŠ›ï¼Œè€Œéå‘é€è¯·æ±‚æœ¬èº«ã€‚æ ¸å¿ƒé€»è¾‘ï¼šæµè§ˆå™¨é˜»æ­¢çš„æ˜¯ JavaScript ä»£ç è·å–è·¨åŸŸè¯·æ±‚çš„å“åº”æ•°æ®ï¼Œè€Œéé˜»æ­¢è¯·æ±‚å‘å‡º

## 0618

- 1471
- ä¸‹å‘¨äºŒè¿›è¡ŒåŠå¹´è¿°èŒï¼Œæ€»ç»“ä¸‹ä¸ŠåŠå¹´åšçš„äº‹ï¼Œå¥½åƒä¹Ÿæ²¡åšå•¥ç‰¹åˆ«çš„éœ€æ±‚ï¼Œéƒ½æ˜¯æ­£å¸¸çš„ä¸šåŠ¡è¿­ä»£
- æ‰‹å†™ Promise.all

```js
function all(promises) {
  return new Promise((resolve, reject) => {
    let len = promises.length
    let data = []
    if (len === 0) return resolve([])
    for (let i = 0; i < len; i++) {
      Promise.resolve(promises[i]).then(
        (res) => {
          data[i] = res
          if (data.length === len) {
            resolve(data)
          }
        },
        (err) => {
          reject(err)
        }
      )
    }
  })
}
```

- æ‰‹å†™ Promis.any

```js
function any(promises) {
  // your code here
  return new Promise((resolve, reject) => {
    let len = promises.length
    let errors = []
    for (let i = 0; i < len; i++) {
      Promise.resolve(promises[i]).then(
        (res) => {
          resolve(res)
        },
        (err) => {
          errors[i] = err
          if (errors.length === len) {
            reject(
              new AggregateError(
                "No Promise in Promise.any was resolved",
                errors
              )
            )
          }
        }
      )
    }
  })
}
```

- å®ç° DOM store

```js
class NodeStore {
  constructor() {
    this.store = {}
  }
  /**
   * @param {Node} node
   * @param {any} value
   */
  set(node, value) {
    node.__store_key__ = node.__store_key__ || Symbol()
    this.store[node.__store_key__] = value
  }
  /**
   * @param {Node} node
   * @return {any}
   */
  get(node) {
    return this.store[node.__store_key__]
  }

  /**
   * @param {Node} node
   * @return {Boolean}
   */
  has(node) {
    return !!this.store[node.__store_key__]
  }
}
```

## æ‰‹å†™å®ç° Object.groupBy()

```js

```

## 0619

- 1472
- å‰ç«¯ AI åº”ç”¨ç»ƒä¹ 
- [SSE](https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events/Using_server-sent_events): SSEï¼šServer-Sent Events æœåŠ¡å™¨æ¨é€äº‹ä»¶ï¼Œç®€ç§° SSEï¼Œæ˜¯ä¸€ç§æœåŠ¡ç«¯å®æ—¶ä¸»åŠ¨å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯çš„æŠ€æœ¯ã€‚SSE æ˜¯ HTML5 ä¸­ä¸€ä¸ªä¸é€šä¿¡ç›¸å…³çš„ APIï¼Œä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæœåŠ¡ç«¯ä¸æµè§ˆå™¨ç«¯çš„é€šä¿¡åè®®ï¼ˆ HTTP åè®®ï¼‰åŠæµè§ˆå™¨ç«¯å¯ä¾› JavaScript ä½¿ç”¨çš„ **EventSource** å¯¹è±¡.

åº”ç”¨åœºæ™¯ï¼š**å‰ç«¯æµå¼æ¸²æŸ“**ï¼šæœåŠ¡ç«¯å°†å¤§æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬åˆ†å—æ¨é€åˆ°å‰ç«¯ï¼Œå®ç°é€è¯è¾“å‡ºæ•ˆæœï¼ˆç±»ä¼¼ ChatGPTï¼‰ã€‚

::: info

### **EventSource**

EventSource æ¥å£æ˜¯ web å†…å®¹ä¸æœåŠ¡å™¨å‘é€äº‹ä»¶é€šä¿¡çš„æ¥å£ã€‚

ä¸€ä¸ª EventSource å®ä¾‹ä¼šå¯¹ HTTP æœåŠ¡å™¨å¼€å¯ä¸€ä¸ªæŒä¹…åŒ–çš„è¿æ¥ï¼Œä»¥ **text/event-stream** æ ¼å¼å‘é€äº‹ä»¶ï¼Œæ­¤è¿æ¥ä¼šä¸€ç›´ä¿æŒå¼€å¯ç›´åˆ°é€šè¿‡è°ƒç”¨ EventSource.close() å…³é—­ã€‚

ä¸€æ—¦è¿æ¥å¼€å¯ï¼Œæ¥è‡ªæœåŠ¡ç«¯ä¼ å…¥çš„æ¶ˆæ¯ä¼šä»¥äº‹ä»¶çš„å½¢å¼åˆ†å‘è‡³ä½ ä»£ç ä¸­ã€‚å¦‚æœæ¥æ”¶æ¶ˆæ¯ä¸­æœ‰ä¸€ä¸ª event å­—æ®µï¼Œè§¦å‘çš„äº‹ä»¶ä¸ event å­—æ®µçš„å€¼ç›¸åŒã€‚å¦‚æœä¸å­˜åœ¨ event å­—æ®µï¼Œåˆ™å°†è§¦å‘é€šç”¨çš„ message äº‹ä»¶ã€‚

ä¸ WebSocket ä¸åŒçš„æ˜¯ï¼ŒæœåŠ¡å™¨å‘é€äº‹ä»¶æ˜¯**å•å‘çš„**ã€‚æ•°æ®æ¶ˆæ¯åªèƒ½ä»æœåŠ¡ç«¯åˆ°å‘é€åˆ°å®¢æˆ·ç«¯ï¼ˆå¦‚ç”¨æˆ·çš„æµè§ˆå™¨ï¼‰ã€‚è¿™ä½¿å…¶æˆä¸ºä¸éœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€æ¶ˆæ¯çš„æƒ…å†µä¸‹çš„æœ€ä½³é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¤„ç†å¦‚ç¤¾äº¤åª’ä½“çŠ¶æ€æ›´æ–°ã€æ¶ˆæ¯æ¥æºï¼ˆnews feedï¼‰æˆ–å°†æ•°æ®ä¼ é€’åˆ°å®¢æˆ·ç«¯å­˜å‚¨æœºåˆ¶ï¼ˆå¦‚ IndexedDB æˆ– web å­˜å‚¨ï¼‰ä¹‹ç±»çš„ï¼ŒEventSource æ— ç–‘æ˜¯ä¸€ä¸ªæœ‰æ•ˆæ–¹æ¡ˆã€‚

- ç®€å•çš„ç¤ºä¾‹

```js
const eventSource = new EventSource('http_api_url', { withCredentials: true })

// å…³é—­è¿æ¥
eventSource.close()

// å¯ä»¥ä½¿ç”¨addEventListener()æ–¹æ³•ç›‘å¬
eventSource.addEventListener('open', function(event) {
  console.log('Connection opened')
})

eventSource.addEventListener('message', function(event) {
  console.log('Received message: ' + event.data);
})

// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶
eventSource.addEventListener('xxx', function(event) {
  console.log('Received message: ' + event.data);
})

eventSource.addEventListener('error', function(event) {
  console.log('Error occurred: ' + event.event);
})
// or ä¹Ÿå¯ä»¥ä½¿ç”¨å±æ€§ç›‘å¬çš„æ–¹å¼
eventSource.onopen = function(event) {
  console.log('Connection opened')
}

eventSource.onmessage = function(event) {
  console.log('Received message: ' + event.data);
}

eventSource.onerror = function(event) {
  console.log('Error occurred: ' + event.event);
})

```

### sse ä¸ websocket æ¯”è¾ƒï¼š

- åè®®ä¸åŒ sse åŸºäº Http åè®®ï¼Œwebsocket åŸºäº TCP
- é€šä¿¡ä¸åŒ sse å•å·¥ï¼Œåªèƒ½æœåŠ¡ç«¯å•å‘å‘é€æ¶ˆæ¯ websocket åŒå·¥ï¼Œå¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶ä¿¡æ¯
- è‡ªåŠ¨é‡è¿ sse å†…ç½®æ–­çº¿é‡è¿å’Œæ¶ˆæ¯è¿½è¸ªï¼Œwebsocket ä¸åœ¨åè®®èŒƒå›´å†…é¡»æ‰‹åŠ¨å®ç°
- æ•°æ®æ ¼å¼ sse æ–‡æœ¬æˆ–ä½¿ç”¨ Base64 ç¼–ç å’Œ gzip å‹ç¼©çš„äºŒè¿›åˆ¶æ¶ˆæ¯ websocket æ”¯æŒå¤šç§
- äº‹ä»¶ sse æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶ç±»å‹ï¼Œwebsocket ä¸æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶ç±»å‹
- è¿æ¥æ•° sse è¿æ¥æ•° HTTP/1.1 6 ä¸ªï¼ŒHTTP/2 å¯åå•†ï¼ˆé»˜è®¤ 100ï¼‰websocket æ— é™åˆ¶

:::

## 0620

- 1473
- [deepseek å……å€¼åå°](https://platform.deepseek.com/usage)
- [æ‰‹å†™ groupBy](https://bigfrontend.dev/zh/problem/implement-groupby)

```js
const items = [
  {
    id: 1,
    kind: "a",
  },
  {
    id: 2,
    kind: "b",
  },
  {
    id: 3,
    kind: "a",
  },
]
const groups = Object.groupBy(items, ({ kind }) => kind)
// {
//   a: [
//     {
//       id: 1,
//       kind: 'a'
//     },
//     {
//       id: 3,
//       kind: 'a'
//     }
//   ],
//   b: [
//     {
//       id: 2,
//       kind: 'b'
//     }
//   ]
// }

/**
 * @template T
 * @template { keyof any } K
 * @param { Array<T> } items
 * @param { (item: T) => K } callback
 * @returns { Record<K, Array<T>> }
 */
function ObjectGroupBy(items, callback) {
  // Your code here
  // return items.reduce((cur, pre) => {
  //   if (pre) {
  //     let key = callback(pre)
  //     let val = pre[key]
  //     cur[key] = val
  //     return cur
  //   }
  // }, {})
  let res = Object.create(null)
  for (let item of items) {
    let key = callback(item)
    if (!(key in res)) {
      res[key] = []
    }
    res[key].push(item)
  }
  return res
}
;[1, 2, 3].map((item) => item * 2) // 2 4 6
Array.prototype.myMap = function (fn, context) {
  let arr = this || []
  let res = []
  for (let i = 0; i < arr.length; i++) {
    res.push(fn.call(context, arr[i], i, this))
  }
  return res
}
;[(1, 2, 3)].reduce((cur, pre) => {
  return pre + cur
}, 0)
Array.prototype.myReduce = function (fn, init) {
  let arr = this || []
  let res = init ? init : arr[0]
  let start = init ? 0 : 1
  for (let i = start; i < arr.length; i++) {
    res = fn.call(null, res, arr[i], i, this)
  }
  return res
}
```

## 0623

- 1476
- å‘¨æœ«éƒ½åœ¨å¸¦å­©å­ï¼ŒåŸºæœ¬æ²¡æœ‰è‡ªå·±çš„æ—¶é—´ï¼Œè¿™ç§ç”Ÿæ´»å¸Œæœ›èµ¶å¿«è¿‡å»

### å¢åŠ æ•°ç»„åŸå‹ group æ–¹æ³•,å®ç°è‡ªå®šä¹‰åˆ†ç±»

```js
var array = [1, 2, 3, 4, 5] // sorted
// expected
var result = {
  bigger: [4, 5],
  smaller: [1, 2, 3],
}
```

- é‡æ¸© groupBy()

```js
function groupBy(items, fn) {
  let res = Object.create(null)
  for (let item of items) {
    let key = fn(item)
    if (!(key in item)) {
      res[key] = []
    }
    res[key].push(item)
  }
  return res
}
```

## 0624

- 1477

### å®ç° Object.is()

```js
Object.is() å’Œ===åŸºäºä¸€è‡´ï¼Œé™¤äº†ä»¥ä¸‹æƒ…å†µï¼š

Object.is(0, -0) // false
0 === -0 // true
Object.is(NaN, NaN) // true
NaN === NaN // false
/**
 * @param {any} a
 * @param {any} b
 * @return {boolean}
 */
function is(a, b) {
  // your code here
  if (Number.isNaN(a) && Number.isNaN(b)) return true
  if (a === 0 && b === 0) return 1/a === 1/b
  return a === b
}
```

### å®ç°è¾…åŠ©å‡½æ•°ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º Â toï¼‰ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª Promise ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šè¢« Â rejectã€‚ç›¸åï¼Œå®ƒæ€»æ˜¯ Â resolveÂ  ä¸€ä¸ªæ•°ç»„ï¼Œæ ¼å¼ä¸º Â [error, data]

```js
function to<T>(promise: Promise<T>): Promise<[Error | null, T | undefined]> {
  return (
    promise.then <
    [null, T] >
    ((data: T) => [null, data]).catch <
    [Error, undefined] >
    ((error) => [error, undefined])
  )
}
function To(promise) {
  return promise.then((res) => [null, red]).catch((err) => [err, undefined])
}
```

## 0630

- 1482
- æ¥è¿™è¾¹å››å¹´ï¼Œåé¢ 2 å¹´ï¼Œä» 2023 å¹´ 11 æœˆå¼€å§‹æ‹…å¿ƒè¢«è£ï¼Œæ‹…å¿ƒäº† 2 å¹´ï¼Œåœ¨è¿™è¾¹ï¼Œæ°¸æ— å‡ºå¤´ä¹‹æ—¥ï¼Œå¹´çºªè½»è½»çš„ï¼Œæœ‰è¿™ç§æƒ³æ³•å¾ˆå±é™©ï¼Œä¸æ„¿ä½ å¤šä¹ˆåŠªåŠ›ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯å«åº•çš„é‚£ä¸€ä¸ªï¼Œæ—©å·²ä¹ æƒ¯
- è¿™æ¬¡è£å‘˜æ„æ–™ä¹‹å†…ï¼Œå¦‚ä½•å‡†å¤‡åç»­é¢è¯•ï¼Œè¿˜è¦ä¿æŒå¸¦å°å­©çš„ç²¾åŠ›è·Ÿæ—¶é—´ï¼Œå®åœ¨ä¸è¡Œï¼Œå°±ä¼‘æ¯åŠå¹´ï¼Œå…¨èŒå¸¦å°å­©
- è™šæ‹Ÿ dom è½¬æ¢çœŸå® DOM

```js
// obj = {
 // tag: '',
 // children: []
 // props: {}
 // }
function render(VNode, app) {
 if(type of VNode) {
   return app.appendChild(document.ceateTextNode(VNode))
 }
 let target = app.appendChild(document.createElement(VNode.tag))
 // props
 let props = VNode.props
 Object.keys(props).forEach(key => {
   target.setAttribute(key, props[key])
 })
 // children
 for(let child of VNode.children) {
   render(child, target)
 }
 return target
}

function render(vnode,parent = null) {
 let mount = parent ? (el) => parent.appendChild(el) : (el) => el
 if (typeof vnode === 'string' || typeof vnode === 'number') {
   return mount(document.createTextNode(vnode))
 } else {
   const dom = mount(document.createElement(vnode))
   for(const child of vnode.children) {
     render(child, dom)
   }
   for(let prop of vnode.props) {
     dom.setAttribute(prop, vnode.props[prop])
   }
   return dom
 }
}
```

virtualize() æ¥å—ä¸€ä¸ª DOM tree ç„¶åè¿”å›ä¸€ä¸ª object literal çš„è¡¨è¾¾

```js
/**
 * @param {HTMLElement}
 * @return {object} object literal presentation
 */
function virtualize(element) {
  // your code here
  const res = {
    type: element.tagName.toLowerCase(),
    props: {},
  }
  for (let arrt of element.attributes) {
    const name = attr.name === "class" ? "className" : attr.name
    res.props[name] = attr.value
  }
  const children = []
  for (let node of element.childNodes) {
    if (node.nodeType === 3) {
      children.push(node.textContent)
    } else {
      children.push(virtualize(node))
    }
  }
  res.props.children = children.length === 1 ? children[0] : children
  return res
}
```
