# 202309

::: info

即将步入秋天，我还是这么菜吗?

> 20230906 是的

:::

## 0901/0902

- 815，距离婚期还有整整一个月
- 多灾多难的一周，终于阔以休息下
- gzip 的原理是什么，如何配置？
  gzip 的核心是 _Deflate_(缩小)，而它使用了 *LZ77 算法*与 _Huffman_ 编码来压缩文件，重复度越高的文件可压缩的空间就越大
  因此 gzip 用于 HTTP 文件传输中，比如 JS、CSS 等，「但一般不会压缩图片」。在 HTTP Response 报文中，用 Content-Encoding 指明使用 gzip 压缩，而以下响应头在大部分生产环境的响应报文中都可以看到！

  ```text
  Accept-Encoding: gzip, deflate, br
  Content-Encoding: gzip
  ```

  gzip 一般在**反向代理**那一层，如 nginx 进行处理，直接使用 C 语言编写，具有更好的性能。

在 nginx 开启 gzip: 配置可参考 gzip module[4]

```js
gzip on;
```

## 0904

- 817
- [RSC react server component](https://mp.weixin.qq.com/s/ossKRpQW6X7eFIc0FOoU9Q)

Server Component 它的渲染是在服务端完成之后通过网络请求交给客户端 React 做整合，如果运行时是 Node.js，在 Server Component 中就可以使用 Node.js 中的所有模块资源，访问数据库这些自然就可以了

## 0905

- 818
- 如何从技术岗转向产品岗？
- 存量贷款利率 3000+2800 降 5800 就行

## 0906

- 819，十一回来之后就是 849，元旦就是 900 天左右,天数在慢慢增长，不知道内功修炼的如何了？
- Node.js 发布 v20.6.0 版本，从该版本开始增加了内置 `.env` 功能，运行时可以指定 `.env` 文件的路径，可以取代以往使用 `dotenv` 模块做的一些事情。

```js
// .env
NODE_ENV = development

// app.js
console.log(process.env.NODE_ENV)

// 控制台执行
node --env-file=.env app.js

//控制台输出
development

```

> 需要注意。v20.6.0 现在还不是稳定版本，不建议用于生产环境，要成为 LTS 版本，到下半年 10 月份了。

- [日 200 亿次调用，喜马拉雅网关的架构设计](https://www.toutiao.com/article/7275250124207473171/?app=news_article&timestamp=1693970768&use_new_style=1&req_id=20230906112608D192CDFFEC8AEC022D9C&group_id=7275250124207473171&share_token=1AAF0F96-87D4-4DF0-B79A-A2A08FF0DCA0&tt_from=weixin&utm_source=weixin&utm_medium=toutiao_ios&utm_campaign=client_share&wxshare_count=1&source=m_redirect&wid=1693971225842)

- Nextjs 中的 rewrite 用法

To match a regex path you can wrap the regex in parenthesis after a parameter, for example `/blog/:slug(\\d{1,})` will match `/blog/123` but not `/blog/abc`:

```js
module.exports = {
  async rewrites() {
    return [
      {
        source: "/old-blog/:post(\\d{1,})",
        destination: "/blog/:post", // Matched parameters can be used in the destination
      },
    ];
  },
};
```

## 0907

- 如何解决跨域问题？
  「协议」，「域名」，「端口」，三者有一不一样，就是跨域，案例一：www.baidu.com 与 zhidao.baidu.com 是跨域。
  目前有两种最常见的解决方案：
  1.cors,需要在服务端设置几个响应头， 比如 **Access-control-Allow-origin:/\*/**

  2.反向代理，在 **nginx/traefik/haproxy** 等反向代理服务器中设置为同一域名

```js
server {
 listen 80;
 server_name bythewayer.com;

 location / {
   # 避免非root路径404
   try_files $uri $uri/ /index.html;
 }

 # 解决跨域
 location /api {
   # 或者是 http://localhost:8080
   proxy_pass http://api.bythewayer.com;
 }
}
```

3.JSONP

JSONP，全称 **JSON with Padding**，为了解决跨域的问题而出现。虽然它只能处理 GET 跨域，虽然现在基本上都使用 CORS 跨域，但仍然要知道它，毕竟面试会问。

JSONP 基于两个原理:

1.动态创建 script，使用 script.src 加载请求跨过跨域
2.script.src 加载的脚本内容为 JSONP: 即 **PADDING(JSON)** 格式

```js
$ curl https://shanyue.tech/api/user?id=100&callback=padding

padding({
  "id": 100,
  "wechat": "xxxxx",
})
```

那请求数据后，如何处理数据呢？此时的 padding 就是处理数据的函数。我们只需要在前端实现定义好 padding 函数即可

```js
window.padding = handleData;
```

基于以上原理，创建 jsonp

```js
function jsonp_simple({ url, onData, params }) {
  const script = document.createElement("script");
  // 一、默认 callback 函数为 padding
  script.src = `${url}?${JSON.stringify({ callback: "padding", ...params })}`;
  // 二、使用 onData 作为 window.padding 函数，接收数据
  window["padding"] = onData;
  // 三、动态加载脚本
  document.body.appendChild(script);
}

// 发送 JSONP 请求
jsonp_simple({
  url: "http://localhost:10010",
  params: { id: 10000 },
  onData(data) {
    console.log("Data:", data);
  },
});
```

此时会有一个问题: window.padding 函数会污染全局变量，如果有多个 JSONP 请求发送如何处理？

```js
function jsonp({ url, onData, params }) {
  const script = document.createElement("script");
  // 一、为了避免全局污染，使用一个随机函数名
  const cbFnName = `JSONP_PADDING_${Math.random().toString().slice(2)}`;
  // 二、默认 callback 函数为 cbFnName
  script.src = `${url}?${JSON.stringify({ callback: cbFnName, ...params })}`;
  // 三、使用 onData 作为 cbFnName 回调函数，接收数据
  window[cbFnName] = function (res) {
    onData(res);
    delete window[cbFnName];
    document.body.removeChild(srcipt);
  };
  document.body.appendChild(script);
}

// 发送 JSONP 请求
jsonp({
  url: "http://localhost:10010",
  params: { id: 10000 },
  onData(data) {
    console.log("Data:", data);
  },
});
```

## 0911

- 824 时间过的飞快，可惜身体已经大不如前
- 还有 20 多天即将步入新的时期
- 技术还在原地踏步，心有力而余不足，能不能出去验证下
  > 想要维持学习状态，需要超强的牵引力和恒心，自己在这方面做的远远不够
